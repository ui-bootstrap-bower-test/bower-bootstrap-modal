angular.module("ui.bootstrap.modal",["ui.bootstrap.transition"]).factory("$$stackedMap",function(){return{createNew:function(){var e=[];return{add:function(t,n){e.push({key:t,value:n})},get:function(t){for(var n=0;n<e.length;n++)if(t==e[n].key)return e[n]},keys:function(){for(var t=[],n=0;n<e.length;n++)t.push(e[n].key);return t},top:function(){return e[e.length-1]},remove:function(t){for(var n=-1,o=0;o<e.length;o++)if(t==e[o].key){n=o;break}return e.splice(n,1)[0]},removeTop:function(){return e.splice(e.length-1,1)[0]},length:function(){return e.length}}}}}).directive("modalBackdrop",["$timeout",function(e){return{restrict:"EA",replace:!0,templateUrl:"template/modal/backdrop.html",link:function(t){t.animate=!1,e(function(){t.animate=!0})}}}]).directive("modalWindow",["$modalStack","$timeout",function(e,t){return{restrict:"EA",scope:{index:"@",animate:"="},replace:!0,transclude:!0,templateUrl:"template/modal/window.html",link:function(n,o,r){n.windowClass=r.windowClass||"",t(function(){n.animate=!0,o[0].focus()}),n.close=function(t){var n=e.getTop();n&&n.value.backdrop&&"static"!=n.value.backdrop&&t.target===t.currentTarget&&(t.preventDefault(),t.stopPropagation(),e.dismiss(n.key,"backdrop click"))}}}}]).factory("$modalStack",["$transition","$timeout","$document","$compile","$rootScope","$$stackedMap",function(e,t,n,o,r,a){function i(){for(var e=-1,t=f.keys(),n=0;n<t.length;n++)f.get(t[n]).value.backdrop&&(e=n);return e}function c(e){var t=n.find("body").eq(0),o=f.get(e).value;f.remove(e),d(o.modalDomEl,o.modalScope,300,function(){o.modalScope.$destroy(),t.toggleClass(p,f.length()>0),l()})}function l(){if(u&&-1==i()){var e=s;d(u,s,150,function(){e.$destroy(),e=null}),u=void 0,s=void 0}}function d(n,o,r,a){function i(){i.done||(i.done=!0,n.remove(),a&&a())}o.animate=!1;var c=e.transitionEndEventName;if(c){var l=t(i,r);n.bind(c,function(){t.cancel(l),i(),o.$apply()})}else t(i,0)}var u,s,p="modal-open",f=a.createNew(),m={};return r.$watch(i,function(e){s&&(s.index=e)}),n.bind("keydown",function(e){var t;27===e.which&&(t=f.top(),t&&t.value.keyboard&&r.$apply(function(){m.dismiss(t.key)}))}),m.open=function(e,t){f.add(e,{deferred:t.deferred,modalScope:t.scope,backdrop:t.backdrop,keyboard:t.keyboard});var a=n.find("body").eq(0),c=i();c>=0&&!u&&(s=r.$new(!0),s.index=c,u=o("<div modal-backdrop></div>")(s),a.append(u));var l=angular.element("<div modal-window></div>");l.attr("window-class",t.windowClass),l.attr("index",f.length()-1),l.attr("animate","animate"),l.html(t.content);var d=o(l)(t.scope);f.top().value.modalDomEl=d,a.append(d),a.addClass(p)},m.close=function(e,t){var n=f.get(e).value;n&&(n.deferred.resolve(t),c(e))},m.dismiss=function(e,t){var n=f.get(e).value;n&&(n.deferred.reject(t),c(e))},m.dismissAll=function(e){for(var t=this.getTop();t;)this.dismiss(t.key,e),t=this.getTop()},m.getTop=function(){return f.top()},m}]).provider("$modal",function(){var e={options:{backdrop:!0,keyboard:!0},$get:["$injector","$rootScope","$q","$http","$templateCache","$controller","$modalStack",function(t,n,o,r,a,i,c){function l(e){return e.template?o.when(e.template):r.get(e.templateUrl,{cache:a}).then(function(e){return e.data})}function d(e){var n=[];return angular.forEach(e,function(e){(angular.isFunction(e)||angular.isArray(e))&&n.push(o.when(t.invoke(e)))}),n}var u={};return u.open=function(t){var r=o.defer(),a=o.defer(),u={result:r.promise,opened:a.promise,close:function(e){c.close(u,e)},dismiss:function(e){c.dismiss(u,e)}};if(t=angular.extend({},e.options,t),t.resolve=t.resolve||{},!t.template&&!t.templateUrl)throw new Error("One of template or templateUrl options is required.");var s=o.all([l(t)].concat(d(t.resolve)));return s.then(function(e){var o=(t.scope||n).$new();o.$close=u.close,o.$dismiss=u.dismiss;var a,l={},d=1;t.controller&&(l.$scope=o,l.$modalInstance=u,angular.forEach(t.resolve,function(t,n){l[n]=e[d++]}),a=i(t.controller,l)),c.open(u,{scope:o,deferred:r,content:e[0],backdrop:t.backdrop,keyboard:t.keyboard,windowClass:t.windowClass})},function(e){r.reject(e)}),s.then(function(){a.resolve(!0)},function(){a.reject(!1)}),u},u}]};return e});